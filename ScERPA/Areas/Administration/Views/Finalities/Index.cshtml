@inject ScERPA.Services.Interfaces.ICommonServices commonServices
@model FinalitiesListViewModel
<partial name="_Esito" />
<br />
<div>
    <h1>@ViewData["Title"]</h1>
</div>
<div class="SearchPanel" id="UsersSearchPanel">
    <div class="accordion" id="accordionExample1">
        <div class="accordion-item">
            <h2 class="accordion-header " id="SearchPanelLabel">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSearchPanel" aria-expanded="true" aria-controls="collapseSearchPanel" autocomplete="none">
                    Mostra/Nascondi i criteri di ricerca
                </button>
            </h2>
            <div id="collapseSearchPanel" class="accordion-collapse collapse show" data-bs-parent="#accordionExample1" role="region" aria-labelledby="SearchPanelLabel">
                <div class="accordion-body neutral-2-bg">
                    <form method="post">
                        <div class="row">
                            <div class="select-wrapper mt-3">
                                <label asp-for='searchPanel.AreaId' class="active mt-3">Area</label>
                                <select asp-for='searchPanel.AreaId' asp-items="@Model.Aree" class="form-control" onchange="GetServicesList('searchPanel_AreaId','searchPanel_ServizioId');" value="@Model.searchPanel.AreaId" autocomplete="off">
                                    <option value="">...</option>
                                </select>
                                <span asp-validation-for="searchPanel.AreaId" class="text-danger"></span>
                            </div>
                            <div class="select-wrapper mt-3">
                                <label asp-for='searchPanel.ServizioId' class="active mt-3">Servizio</label>
                                <select asp-for='searchPanel.ServizioId' asp-items="@Model.Servizi" class="form-control" value="@Model.searchPanel.ServizioId" autocomplete="off">
                                    <option value="">...</option>
                                </select>
                                <span asp-validation-for="searchPanel.ServizioId" class="text-danger"></span>
                            </div>
                            <div class="form-group mt-4 col-6 col-lg-4">
                                <label class="active" asp-for="searchPanel.DenominazioneFinalita">Nome finalità</label>
                                <input type="text" asp-for="searchPanel.DenominazioneFinalita" class="form-control" autocomplete="off" aria-required="true" value="@Model.searchPanel.DenominazioneFinalita" />
                                <span asp-validation-for="searchPanel.DenominazioneFinalita" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group mt-3">
                            <button type="submit" class="btn btn-secondary">
                                <span>Cerca</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<h3>Elenco finalità</h3>
<br>
@if(Model.Elenco.Count>0)
{
    <div class="table-responsive rounded shadow">
        <table id="TabellaEServices" name="TabellaEServices" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col">Id</th>
                    <th scope="col">Area</th>
                    <th scope="col">Nome servizio</th>
                    <th scope="col">Finalità</th>
                    <th scope="col">Dal</th>
                    <th scope="col">Al</th>
                    <th ></th>
                    <th ></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var elemento in Model.Elenco)
                {
                    <tr>
                        <td>@elemento.Id</td>
                        <td>@elemento.Area</td>
                        <td>@elemento.Servizio</td>
                        <td>
                            <a asp-action="Details" asp-route-id="@elemento.Id" aria-label="Dettaglio finalità @elemento.Nome"><span>@elemento.Nome</span></a>
                        </td>
                        <td>@elemento.DataDal</td>
                        <td>@elemento.DataAl</td>
                        <td>
                            <a asp-area="Administration" asp-controller="Finalities" asp-action="Edit" asp-route-id="@elemento.Id" class="btn btn-outline-primary btn-me" role="button" aria-label="Modifica finalità @(elemento.Nome)">
                                <span>Modifica</span>
                            </a>
                        </td>
                        <td>
                            <a asp-area="Administration" asp-controller="Finalities" asp-action="Delete" asp-route-id="@elemento.Id" class="btn btn-outline-danger btn-me" role="button" aria-label="Elimina finalità @(elemento.Nome)">
                                <span>Elimina</span>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <nav class="pagination-wrapper justify-content-center mt-3" aria-label="Pagine dei risultati di ricerca">
        <ul class="pagination">

            @if (Model.paging.PageIndex > 1)
            {
                <li class="page-item">
                    <a class="page-link" asp-action="Index" asp-route-areaId="@Model.searchPanel.AreaId" asp-route-servizioId="@Model.searchPanel.ServizioId" asp-route-denominazioneFinalita="@Model.searchPanel.DenominazioneFinalita" asp-route-page="@(Model.paging.PageIndex-1)">
                        <svg class="icon icon-primary"><use href='@(commonServices.SpritesPath+"/sprites.svg#it-chevron-left")'></use></svg>
                        <span class="visually-hidden">Pagina precedente</span>
                    </a>
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <a class="page-link" tabindex="-1" aria-hidden="true" asp-action="Index" asp-route-areaId="@Model.searchPanel.AreaId" asp-route-servizioId="@Model.searchPanel.ServizioId" asp-route-denominazioneFinalita="@Model.searchPanel.DenominazioneFinalita" asp-route-page="1">
                        <svg class="icon icon-primary"><use href='@(commonServices.SpritesPath+"/sprites.svg#it-chevron-left")'></use></svg>
                        <span class="visually-hidden">Pagina precedente</span>
                    </a>
                </li>
            }

            @for (int pageIndex = 1; pageIndex <= Model.paging.TotalPages; pageIndex++)
            {
          
                    @if (pageIndex != Model.paging.PageIndex)
                    {
                        <li class="page-item d-none d-sm-flex">
                            <a class="page-link"  asp-action="Index" asp-route-areaId="@Model.searchPanel.AreaId" asp-route-servizioId="@Model.searchPanel.ServizioId" asp-route-denominazioneFinalita="@Model.searchPanel.DenominazioneFinalita" asp-route-page="@pageIndex">
                                @pageIndex
                            </a>
                        </li>
                    }                 
                    else
                    {
                        <li class="page-item active">
                            <a class="page-link" aria-current="page" asp-action="Index" asp-route-areaId="@Model.searchPanel.AreaId" asp-route-servizioId="@Model.searchPanel.ServizioId" asp-route-denominazioneFinalita="@Model.searchPanel.DenominazioneFinalita" asp-route-page="@pageIndex">
                                <span class="d-inline-block d-sm-none">Pagina </span>@pageIndex
                            </a>
                        </li>
                    }
                              
            }

            @if (Model.paging.PageIndex != Model.paging.TotalPages)
            {
                <li class="page-item">
                    <a class="page-link" asp-action="Index" asp-route-areaId="@Model.searchPanel.AreaId" asp-route-servizioId="@Model.searchPanel.ServizioId" asp-route-denominazioneFinalita="@Model.searchPanel.DenominazioneFinalita" asp-route-page="@(Model.paging.PageIndex+1)">
                        <svg class="icon icon-primary"><use href='@(commonServices.SpritesPath+"/sprites.svg#it-chevron-right")'></use></svg>
                        <span class="visually-hidden">Pagina seguente</span>
                    </a>
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <a class="page-link" tabindex="-1" aria-hidden="true" asp-action="Index" asp-route-areaId="@Model.searchPanel.AreaId" asp-route-servizioId="@Model.searchPanel.ServizioId" asp-route-denominazioneFinalita="@Model.searchPanel.DenominazioneFinalita" asp-route-page="@(Model.paging.TotalPages)">
                        <svg class="icon icon-primary"><use href='@(commonServices.SpritesPath+"/sprites.svg#it-chevron-right")'></use></svg>
                        <span class="visually-hidden">Pagina seguente</span>
                    </a>
                </li>
            }

        </ul>
    </nav>
} else
{
    <div class="alert alert-info" role="alert">
        <p>Nessuna finalità trovata</p>
    </div>    
}
<br />
<p>
    <a asp-area="Administration" asp-controller="Finalities" asp-action="Create" class="btn btn-primary btn-me" role="button">
        <span>Nuova finalità</span>
    </a>
</p>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="/js/FinalityUtilities.js"></script>
}